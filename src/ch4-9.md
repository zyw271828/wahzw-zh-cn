# 可验证计算协议

我们基于前文中**多项式知识协议** 做了很多重要的修改使它变得更通用，我们再来看一下它现在的定义。假定函数 *f*(*) 是要证明的问题中的计算结果，其中操作数的数量为*d*，变量的数量*n* ，以及它们对应的系数为：

$\{c_{L,i,j},c_{R,i,j},c_{o,i,j}\}_{i \in {1,…,d}, j \in {i,…,d}}$

* Setup
  * 为左操作数 $\{l_i(x)\}_{i \in \{1,…,n\}}$ 构造*变量多项式* 然后对于所有 $j \in \{1,…,d\}$ 的运算都算出其对应的系数，即 $l_i(j) = c_{L,i,j}$，对右操作数和输出也做同样的事情。
  * 随机抽取 *s*，$α$
  * 计算 *t(x)= (x-1)(x-2)…(x-d)* 及其结果 $g^{t(s)}$
  * 计算 *proving key*：

    $(\{g^{s^k}\}_{k \in[d]},\{g^{l_i(s)}, g^{r_i(s)}, g^{o_i(s)},g^{αl_i(s)},g^{αr_i(s)},g^{αo_i(s)}\}_{i \in \{1,……,n\}})$

  * 计算 *verification key*：

    $(g^{t(s)},g^α)$

* Proving
  * 计算函数 *f(\*)* 以此计算相应的变量 $\{v_i\}_{i \in \{1,…,n\}}$
  * 计算 $h(x) = \frac{L(x) \times R(x) - O(x)}{t(x)}$，其中 $L(x) = \sum_{i=1}^n {v_i \cdot l_i(x)}$，$R(x)$, $O(x)$ 与之相似
  * 给变量赋值并对操作数多项式求和：

    $g^{L(s)} = (g^{l_1(s)})^{v_1}…(g^{l_n(s)})^{v_n},g^{R(s)} = \prod_{i=1}^n{(g^{r_i(s)})^{v_i}}, g^{O(s)} = \prod_{i=1}^n{(g^{o_i(s)})^{v_i}}$

  * 对变换后的多项式赋值：

    $g^{αL(s)} = \prod_{i=1}^n{(g^{αl_i(s)})^{v_i}},g^{αR(s)} = \prod_{i=1}^n{(g^{αr_i(s)})^{v_i}}, g^{αO(s)} = \prod_{i=1}^n{(g^{αo_i(s)})^{v_i}}$

  * 使用 s 的幂加密值：$\{g^{s^k}\}_{k \in [d]}$ 计算加密值 $g^{h(s)}$
  * 生成证明：$\{g^{L(s)},g^{R(s)},g^{O(s)},g^{αL(s)},g^{αR(s)},g^{αO(s)},g^{h(s)}\}$

* Verification
  * 解析证明为 $\{g^L,g^R,g^O,g^{L'},g^{R'},g^{O'},g^{h}\}$
  * 检查可变多项式约束：

    $e(g^L,g^α) = e(g^{L'},g), e(g^R,g^α) = e(g^{R'},g), e(g^O,g^α)=e(g^{O'},g)$

  * 验证计算有效性：

    $e(g^L,g^R) = e(g^t,g^h) \cdot e(g^O,g)$

*注意：使用符号  ∏ 来表示多个元素连乘，即： $\prod_{i=1}^n{v_i} = v_1 \cdot v_2 \cdot … \cdot v_n$*

对于 *i ∈ {1, …, n}* 所有变量多项式 {*lᵢ*(*x*)*, rᵢ*(*x*)*, oᵢ*(*x*)}  和目标多项式 *t(x)* 的设置被称为一个*二元算术程序* (QAP，在[[Gen+12](#8bfc)] 中有介绍)。

虽然协议足够健壮，可以进行常规的计算验证，但这里依然还有两个安全考虑需要去解决。
